/selectstar-server
│
├── /config             # Database connection & environment variables
│   └── db.js           # (Your Admin and Student pools)
│
├── /controllers        # The "Brains" (Logic for checking answers, etc.)
│   ├── queryController.js
│   └── challengeController.js
│
├── /routes             # The "Map" (Definition of endpoints)
│   ├── queryRoutes.js
│   └── challengeRoutes.js
│
├── /middleware         # Security & Helpers
│   └── security.js      # (Your Regex/Forbidden keywords check)
│
├── .env                # Secret keys (not committed to Git)
├── docker-compose.yml
├── init-sandbox.sql
└── server.js           # Entry point (Initializes Express)

config:/db.js

const { Pool } = require('pg');
const client = new Pool({ /* admin config */ });
const studentpool = new Pool({ /* student config */ });
module.exports = { client, studentpool };


controllers:/queryController.js
const { studentpool } = require('../config/db');

exports.executeSandboxQuery = async (req, res) => {
    // ... all your BEGIN / ROLLBACK logic goes here
};



middleware/security.js
This keeps your routes clean. You can "plug" this into any route that needs protection.

JavaScript

const validateSQL = (req, res, next) => {
    const { sql } = req.body;
    if (/\b(DROP|DELETE|ALTER|TRUNCATE)\b/i.test(sql)) {
        return res.status(403).send('Forbidden keyword detected.');
    }
    next(); // Move to the next function (the controller)
};
module.exports = { validateSQL };


D. /routes/queryRoutes.js
The route handles the "where."

JavaScript

const express = require('express');
const router = express.Router();
const queryController = require('../controllers/queryController');
const { validateSQL } = require('../middleware/security');

// Apply security middleware AND then the controller
router.post('/execute', validateSQL, queryController.executeSandboxQuery);

module.exports = router;
3. The server.js (The Glue)
Your main file becomes very short and easy to read.

JavaScript

const express = require('express');
const queryRoutes = require('./routes/queryRoutes');
const challengeRoutes = require('./routes/challengeRoutes');

const app = express();
app.use(express.json());

// Mount the routes
app.use('/api/query', queryRoutes);
app.use('/api/challenges', challengeRoutes);

app.listen(3000, () => console.log('Server running on port 3000'));